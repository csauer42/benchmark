# test pipeline to verify sccache functionality

name: $(Date:yyyy.MM.dd)$(Rev:r)

trigger:
- main

pr: none

resources:
- repo: self

pool:
  vmImage: ubuntu-latest

variables:
- group: sccache-vars
- name: SCCACHE_AZURE_BLOB_CONTAINER
  value: $(blob_container)
- name: SCCACHE_AZURE_CONNECTION_STRING
  value: $(connection_string)

jobs:
- job: Build
  container:
    image: docker.io/csauer42/cmake-builder
    endpoint: docker-hub-csauer42
  steps:
  # - script: |
  #     #export SCCACHE_AZURE_BLOB_CONTAINER='$(blob_container)'
  #     #export SCCACHE_AZURE_CONNECTION_STRING='$(connection_string)'
  #     #env | grep AZURE
  #     echo "##vso[task.setvariable variable=SCCACHE_AZURE_BLOB_CONTAINER]$(blob_container)"
  #     echo "##vso[task.setvariable variable=SCCACHE_AZURE_CONNECTION_STRING]$(connection_string)"
  - task: CMake@1
    inputs:
      cmakeArgs: -DBENCHMARK_DOWNLOAD_DEPENDENCIES=on -DCMAKE_BUILD_TYPE=Release ../
  - script: |
      env | grep AZURE
  - task: CMake@1
    inputs:
      cmakeArgs: --build . --config Release
  - script: |
      sccache --version
      sccache -s
